"use strict";(globalThis.webpackChunkbuhaoqi_github_io=globalThis.webpackChunkbuhaoqi_github_io||[]).push([[5153],{1955(n,e,E){E.r(e),E.d(e,{assets:()=>r,contentTitle:()=>c,default:()=>N,frontMatter:()=>i,metadata:()=>l,toc:()=>a});const l=JSON.parse('{"id":"mysql/ch09/task2","title":"\u4efb\u52a1\u4e8c \u4e8b\u4ef6","description":"\u4e00\u3001\u4e8b\u4ef6\u662f\u4ec0\u4e48","source":"@site/docs/mysql/ch09/task2.md","sourceDirName":"mysql/ch09","slug":"/mysql/ch09/task2","permalink":"/docs/mysql/ch09/task2","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/mysql/ch09/task2.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"\u4efb\u52a1\u4e8c \u4e8b\u4ef6","sidebar_label":"\u4efb\u52a1\u4e8c \u4e8b\u4ef6","sidebar_position":2},"sidebar":"mysqlSidebar","previous":{"title":"\u4efb\u52a1\u4e00 \u89e6\u53d1\u5668","permalink":"/docs/mysql/ch09/task1"},"next":{"title":"\u4efb\u52a1\u4e09 \u5b58\u50a8\u8fc7\u7a0b","permalink":"/docs/mysql/ch09/task3"}}');var s=E(4848),d=E(8453);const i={title:"\u4efb\u52a1\u4e8c \u4e8b\u4ef6",sidebar_label:"\u4efb\u52a1\u4e8c \u4e8b\u4ef6",sidebar_position:2},c=void 0,r={},a=[{value:"\u4e00\u3001\u4e8b\u4ef6\u662f\u4ec0\u4e48",id:"\u4e00\u4e8b\u4ef6\u662f\u4ec0\u4e48",level:2},{value:"\u4e8c\u3001\u521b\u5efa\u4e8b\u4ef6\u7684\u57fa\u672c\u8bed\u6cd5",id:"\u4e8c\u521b\u5efa\u4e8b\u4ef6\u7684\u57fa\u672c\u8bed\u6cd5",level:2},{value:"\u4e09\u3001\u8bed\u6cd5\u8be6\u89e3",id:"\u4e09\u8bed\u6cd5\u8be6\u89e3",level:2},{value:"1. \u4e8b\u4ef6\u540d\u79f0",id:"1-\u4e8b\u4ef6\u540d\u79f0",level:3},{value:"2.\u65f6\u95f4\u8ba1\u5212\uff08ON SCHEDULE\uff09",id:"2\u65f6\u95f4\u8ba1\u5212on-schedule",level:3},{value:"\u2460 AT:\u4e00\u6b21\u6027\u4e8b\u4ef6",id:"-at\u4e00\u6b21\u6027\u4e8b\u4ef6",level:4},{value:"\u2461 EVERY:\u5468\u671f\u6027\u4e8b\u4ef6",id:"-every\u5468\u671f\u6027\u4e8b\u4ef6",level:4},{value:"\u2462 \u6307\u5b9a\u5f00\u59cb\u548c\u7ed3\u675f\u65f6\u95f4",id:"-\u6307\u5b9a\u5f00\u59cb\u548c\u7ed3\u675f\u65f6\u95f4",level:4},{value:"\u2463 \u6307\u5b9a\u65f6\u95f4\u95f4\u9694(INTERVAL)",id:"-\u6307\u5b9a\u65f6\u95f4\u95f4\u9694interval",level:4},{value:"\u5b9a\u4e49\uff1a",id:"\u5b9a\u4e49",level:5},{value:"\u57fa\u672c\u8bed\u6cd5\u683c\u5f0f",id:"\u57fa\u672c\u8bed\u6cd5\u683c\u5f0f",level:4},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:5},{value:"3. \u4e8b\u4ef6\u72b6\u6001",id:"3-\u4e8b\u4ef6\u72b6\u6001",level:3},{value:"4. \u4e8b\u4ef6\u4f53\uff08DO\uff09",id:"4-\u4e8b\u4ef6\u4f53do",level:3},{value:"\u4e09\u3001\u5b9e\u9645\u5e94\u7528\u793a\u4f8b",id:"\u4e09\u5b9e\u9645\u5e94\u7528\u793a\u4f8b",level:2},{value:"\u793a\u4f8b1\uff1a\u6570\u636e\u6e05\u7406\u4efb\u52a1",id:"\u793a\u4f8b1\u6570\u636e\u6e05\u7406\u4efb\u52a1",level:3},{value:"\u793a\u4f8b2\uff1a\u5b9a\u671f\u6570\u636e\u7edf\u8ba1",id:"\u793a\u4f8b2\u5b9a\u671f\u6570\u636e\u7edf\u8ba1",level:3},{value:"\u793a\u4f8b3\uff1a\u7cfb\u7edf\u76d1\u63a7",id:"\u793a\u4f8b3\u7cfb\u7edf\u76d1\u63a7",level:3},{value:"\u793a\u4f8b4\uff1a\u6bcf\u5929\u51cc\u6668\u6267\u884c(CURDATE())",id:"\u793a\u4f8b4\u6bcf\u5929\u51cc\u6668\u6267\u884ccurdate",level:3},{value:"\u793a\u4f8b5\uff1a\u6bcf\u67081\u53f7\u6267\u884c",id:"\u793a\u4f8b5\u6bcf\u67081\u53f7\u6267\u884c",level:3},{value:"\u793a\u4f8b6\uff1a\u4f7f\u7528\u53d8\u91cf\u8bbe\u7f6e\u95f4\u9694",id:"\u793a\u4f8b6\u4f7f\u7528\u53d8\u91cf\u8bbe\u7f6e\u95f4\u9694",level:3},{value:"\u793a\u4f8b7:\u9a8c\u8bc1\u65f6\u95f4\u95f4\u9694",id:"\u793a\u4f8b7\u9a8c\u8bc1\u65f6\u95f4\u95f4\u9694",level:3},{value:"\u56db\u3001\u5e38\u89c1\u4e8b\u4ef6\u793a\u4f8b",id:"\u56db\u5e38\u89c1\u4e8b\u4ef6\u793a\u4f8b",level:2},{value:"1. \u4e00\u6b21\u6027\u4e8b\u4ef6",id:"1-\u4e00\u6b21\u6027\u4e8b\u4ef6",level:3},{value:"2. \u5468\u671f\u6027\u4e8b\u4ef6",id:"2-\u5468\u671f\u6027\u4e8b\u4ef6",level:3},{value:"3. \u590d\u6742\u4e8b\u4ef6",id:"3-\u590d\u6742\u4e8b\u4ef6",level:3},{value:"4.\u5176\u4ed6\u4e8b\u4ef6",id:"4\u5176\u4ed6\u4e8b\u4ef6",level:3},{value:"5.\u5b8c\u6574\u793a\u4f8b",id:"5\u5b8c\u6574\u793a\u4f8b",level:3},{value:"\u793a\u4f8b1\uff1a\u6bcf\u65e5\u6e05\u7406\u4efb\u52a1",id:"\u793a\u4f8b1\u6bcf\u65e5\u6e05\u7406\u4efb\u52a1",level:4},{value:"\u793a\u4f8b2\uff1a\u6bcf\u5c0f\u65f6\u7edf\u8ba1\u6570\u636e",id:"\u793a\u4f8b2\u6bcf\u5c0f\u65f6\u7edf\u8ba1\u6570\u636e",level:4},{value:"\u793a\u4f8b3\uff1a\u6708\u5ea6\u5f52\u6863",id:"\u793a\u4f8b3\u6708\u5ea6\u5f52\u6863",level:4},{value:"\u4e94\u3001\u7ba1\u7406\u4e8b\u4ef6",id:"\u4e94\u7ba1\u7406\u4e8b\u4ef6",level:2},{value:"\u516d\u3001\u603b\u7ed3",id:"\u516d\u603b\u7ed3",level:2},{value:"1.INTERVAL\u7684\u5e38\u89c1\u7528\u6cd5",id:"1interval\u7684\u5e38\u89c1\u7528\u6cd5",level:3},{value:"2.DO \u5b50\u53e5",id:"2do-\u5b50\u53e5",level:3},{value:"3.ENABLE / DISABLE\uff08\u542f\u7528\u4e0e\u505c\u7528\uff09",id:"3enable--disable\u542f\u7528\u4e0e\u505c\u7528",level:3},{value:"4.\u5b9e\u9645\u5f00\u53d1\u4e2d\uff1a",id:"4\u5b9e\u9645\u5f00\u53d1\u4e2d",level:3},{value:"5.\u4e8b\u4ef6\u80fd\u505a\u4ec0\u4e48\uff1f",id:"5\u4e8b\u4ef6\u80fd\u505a\u4ec0\u4e48",level:3}];function T(n){const e={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,d.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h2,{id:"\u4e00\u4e8b\u4ef6\u662f\u4ec0\u4e48",children:"\u4e00\u3001\u4e8b\u4ef6\u662f\u4ec0\u4e48"}),"\n",(0,s.jsx)(e.p,{children:"\u4e00\u53e5\u8bdd\u5b9a\u4e49"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u4e8b\u4ef6(EVENT)\u662fMySQL\u6570\u636e\u5e93\u7684\u4e00\u79cd\u6309\u7167\u6307\u5b9a\u65f6\u95f4\u81ea\u52a8\u6267\u884c\u4efb\u52a1\u7684\u5de5\u4f5c\u673a\u5236\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u7279\u70b9\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u57fa\u4e8e\u65f6\u95f4"}),"\n",(0,s.jsx)(e.li,{children:"\u81ea\u52a8\u6267\u884c"}),"\n",(0,s.jsx)(e.li,{children:"\u5b9a\u65f6\u4efb\u52a1"}),"\n",(0,s.jsx)(e.li,{children:"\u65e0\u9700\u4eba\u5de5\u8c03\u7528"}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u4e8c\u521b\u5efa\u4e8b\u4ef6\u7684\u57fa\u672c\u8bed\u6cd5",children:"\u4e8c\u3001\u521b\u5efa\u4e8b\u4ef6\u7684\u57fa\u672c\u8bed\u6cd5"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u5355\u6761 SQL \u8bed\u53e5\nCREATE EVENT \u4e8b\u4ef6\u540d\nON SCHEDULE \u65f6\u95f4\u89c4\u5219 -- \u6838\u5fc3\uff1a\u6307\u5b9a\u4e8b\u4ef6\u6267\u884c\u7684\u65f6\u95f4/\u5468\u671f\nDO\n  event_body; -- \u8981\u6267\u884c\u7684\u5355\u6761SQL\u8bed\u53e5\n\n-- \u591a\u6761 SQL \u8bed\u53e5\nDELIMITER //\nCREATE EVENT \u4e8b\u4ef6\u540d\nON SCHEDULE \u65f6\u95f4\u89c4\u5219 -- \u6838\u5fc3\uff1a\u6307\u5b9a\u4e8b\u4ef6\u6267\u884c\u7684\u65f6\u95f4/\u5468\u671f\n[ENABLE | DISABLE | DISABLE ON SLAVE] -- \u4e8b\u4ef6\u72b6\u6001\nDO \nBEGIN\n    event_body; -- \u8981\u6267\u884c\u7684\u591a\u6761SQL\u8bed\u53e5\n    SQL\u8bed\u53e51;\n    SQL\u8bed\u53e52;\nEND //\n\nDELIMITER ;\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u4e09\u8bed\u6cd5\u8be6\u89e3",children:"\u4e09\u3001\u8bed\u6cd5\u8be6\u89e3"}),"\n",(0,s.jsx)(e.h3,{id:"1-\u4e8b\u4ef6\u540d\u79f0",children:"1. \u4e8b\u4ef6\u540d\u79f0"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE EVENT my_event  -- \u57fa\u672c\u547d\u540d\nCREATE EVENT IF NOT EXISTS my_event  -- \u907f\u514d\u91cd\u590d\u521b\u5efa\u9519\u8bef\n"})}),"\n",(0,s.jsx)(e.h3,{id:"2\u65f6\u95f4\u8ba1\u5212on-schedule",children:"2.\u65f6\u95f4\u8ba1\u5212\uff08ON SCHEDULE\uff09"}),"\n",(0,s.jsx)(e.h4,{id:"-at\u4e00\u6b21\u6027\u4e8b\u4ef6",children:"\u2460 AT:\u4e00\u6b21\u6027\u4e8b\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u5728\u7279\u5b9a\u65f6\u95f4\u6267\u884c\nON SCHEDULE AT '2024-12-31 23:59:59'\n\n-- \u5728\u5f53\u524d\u65f6\u95f41\u5c0f\u65f6\u540e\u6267\u884c\nON SCHEDULE AT CURRENT_TIMESTAMP + INTERVAL 1 HOUR\n\n-- \u4f7f\u7528\u65f6\u95f4\u6233\nON SCHEDULE AT TIMESTAMP '2024-12-31 23:59:59'\n"})}),"\n",(0,s.jsx)(e.h4,{id:"-every\u5468\u671f\u6027\u4e8b\u4ef6",children:"\u2461 EVERY:\u5468\u671f\u6027\u4e8b\u4ef6"}),"\n",(0,s.jsx)(e.p,{children:"\u8bed\u6cd5"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"EVERY NUMBER \u65f6\u95f4\u5355\u4f4d\n"})}),"\n",(0,s.jsx)(e.p,{children:"MySQL \u652f\u6301\u7684\u6240\u6709\u65f6\u95f4\u5355\u4f4d"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"MICROSECOND    -- \u5fae\u79d2\nSECOND         -- \u79d2\nMINUTE         -- \u5206\u949f\nHOUR           -- \u5c0f\u65f6\nDAY            -- \u5929\nWEEK           -- \u5468\nMONTH          -- \u6708\nQUARTER        -- \u5b63\u5ea6\uff083\u4e2a\u6708\uff09\nYEAR           -- \u5e74\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"ON SCHEDULE EVERY 3 YEAR      -- \u6bcf3\u5e74\nON SCHEDULE EVERY 3 MONTH     -- \u6bcf3\u4e2a\u6708\nON SCHEDULE EVERY 2 WEEK      -- \u6bcf2\u5468\nON SCHEDULE EVERY 3 DAY       -- \u6bcf3\u5929\nON SCHEDULE EVERY 3 HOUR      -- \u6bcf3\u5c0f\u65f6\nON SCHEDULE EVERY 3 MINUTE    -- \u6bcf3\u5206\u949f\nON SCHEDULE EVERY 3 SECOND    -- \u6bcf3\u79d2\nON SCHEDULE EVERY 1 QUARTER   -- \u6bcf1\u5b63\u5ea6\uff08\u6bcf3\u4e2a\u6708\uff09\nON SCHEDULE EVERY 1.5 SECOND    -- \u6bcf1.5\u79d2\uff08MySQL 5.6.4+\uff09\nON SCHEDULE EVERY 0.5 HOUR      -- \u6bcf\u534a\u5c0f\u65f6\uff0830\u5206\u949f\uff09\nON SCHEDULE EVERY 0.25 DAY      -- \u6bcf6\u5c0f\u65f6\n\n-- \u6bcf\u5206\u949f\u6267\u884c\nCREATE EVENT event_minute\nON SCHEDULE EVERY 1 MINUTE\nDO UPDATE table SET count = count + 1;\n\n-- \u6bcf2\u5c0f\u65f6\u6267\u884c\nCREATE EVENT event_hourly\nON SCHEDULE EVERY 2 HOUR\nDO UPDATE table SET status = 'checked';\n\n-- \u6bcf\u5929\u6267\u884c\nCREATE EVENT event_daily\nON SCHEDULE EVERY 1 DAY\nDO DELETE FROM logs WHERE created_at < NOW() - INTERVAL 30 DAY;\n\n-- \u6bcf\u5468\u6267\u884c\nCREATE EVENT event_weekly\nON SCHEDULE EVERY 1 WEEK\nDO CALL generate_weekly_report();\n\n-- \u6bcf\u6708\u6267\u884c\nCREATE EVENT event_monthly\nON SCHEDULE EVERY 1 MONTH\nDO OPTIMIZE TABLE large_table;\n\n-- \u6bcf\u5206\u949f\u6267\u884c\nON SCHEDULE EVERY 1 MINUTE\n\n-- \u6bcf\u5c0f\u65f6\u6267\u884c\nON SCHEDULE EVERY 1 HOUR\n\n-- \u6bcf\u5929\u51cc\u66682\u70b9\u6267\u884c\nON SCHEDULE EVERY 1 DAY STARTS '2024-01-01 02:00:00'\n\n-- \u6bcf\u5468\u4e00\u65e9\u4e0a8\u70b9\nON SCHEDULE EVERY 1 WEEK STARTS '2024-01-01 08:00:00'\n\n-- \u6bcf\u6708\u7b2c\u4e00\u5929\nON SCHEDULE EVERY 1 MONTH STARTS '2024-02-01 00:00:00'\n\n-- \u6307\u5b9a\u7ed3\u675f\u65f6\u95f4\uff081\u5e74\u540e\u505c\u6b62\uff09\nON SCHEDULE EVERY 1 DAY\n  STARTS CURRENT_TIMESTAMP\n  ENDS CURRENT_TIMESTAMP + INTERVAL 1 YEAR\n"})}),"\n",(0,s.jsx)(e.h4,{id:"-\u6307\u5b9a\u5f00\u59cb\u548c\u7ed3\u675f\u65f6\u95f4",children:"\u2462 \u6307\u5b9a\u5f00\u59cb\u548c\u7ed3\u675f\u65f6\u95f4"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"ON SCHEDULE EVERY 1 DAY\nSTARTS '2026-02-01 00:00:00'\nENDS   '2026-03-01 00:00:00'\n"})}),"\n",(0,s.jsx)(e.p,{children:"\ud83d\udccc \u542b\u4e49\uff1a"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u4ece 2 \u6708 1 \u65e5\u5f00\u59cb\uff0c\u5230 3 \u6708 1 \u65e5\u7ed3\u675f\uff0c\u6bcf\u5929\u6267\u884c\u4e00\u6b21"}),"\n"]}),"\n",(0,s.jsx)(e.h4,{id:"-\u6307\u5b9a\u65f6\u95f4\u95f4\u9694interval",children:"\u2463 \u6307\u5b9a\u65f6\u95f4\u95f4\u9694(INTERVAL)"}),"\n",(0,s.jsx)(e.h5,{id:"\u5b9a\u4e49",children:"\u5b9a\u4e49\uff1a"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"INTERVAL \u7528\u4e8e\u6307\u5b9a\u65f6\u95f4\u95f4\u9694\uff0c\u662f\u4e8b\u4ef6\u8c03\u5ea6\u4e2d\u6700\u91cd\u8981\u7684\u65f6\u95f4\u5355\u4f4d\u5b9a\u4e49\u5173\u952e\u5b57\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.h4,{id:"\u57fa\u672c\u8bed\u6cd5\u683c\u5f0f",children:"\u57fa\u672c\u8bed\u6cd5\u683c\u5f0f"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"INTERVAL number unit(\u5355\u4f4d)\n"})}),"\n",(0,s.jsx)(e.h5,{id:"\u793a\u4f8b",children:"\u793a\u4f8b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- 10\u5206\u949f\u540e\u6267\u884c\u4e00\u6b21\nCREATE EVENT event_once\nON SCHEDULE AT NOW() + INTERVAL 10 MINUTE\nDO DELETE FROM temp_table;\n\n-- \u660e\u5929\u4e2d\u534812\u70b9\u6267\u884c\nCREATE EVENT event_noon\nON SCHEDULE AT CURDATE() + INTERVAL 1 DAY + INTERVAL 12 HOUR\nDO CALL send_daily_summary();\n\n-- 5\u5206\u949f\u540e\u5f00\u59cb\u6267\u884c\nCREATE EVENT event_delayed\nON SCHEDULE EVERY 1 DAY\nSTARTS NOW() + INTERVAL 5 MINUTE\nDO INSERT INTO backups SELECT * FROM data;\n\n-- \u660e\u5929\u51cc\u66682\u70b9\u5f00\u59cb\nCREATE EVENT event_tomorrow\nON SCHEDULE EVERY 1 DAY\nSTARTS CURDATE() + INTERVAL 1 DAY + INTERVAL 2 HOUR\nDO UPDATE stats SET daily_count = 0;\n\n-- 1\u5e74\u540e\u7ed3\u675f\nCREATE EVENT event_temporary\nON SCHEDULE EVERY 1 WEEK\nSTARTS NOW()\nENDS NOW() + INTERVAL 1 YEAR\nDO ARCHIVE old_records;\n\n-- \u6bcf\u5c0f\u65f6\u6267\u884c\uff0c24\u5c0f\u65f6\u540e\u7ed3\u675f\uff08\u517124\u6b21\uff09\nCREATE EVENT event_limited\nON SCHEDULE EVERY 1 HOUR\nSTARTS NOW()\nENDS NOW() + INTERVAL 24 HOUR\nDO INSERT INTO logs (message) VALUES ('Hourly check');\n\n-- \u6bcf\u96941\u59292\u5c0f\u65f630\u5206\u949f\nCREATE EVENT event_complex\nON SCHEDULE EVERY 1 DAY + INTERVAL 2 HOUR + INTERVAL 30 MINUTE\nDO REFRESH cache_data;\n\n-- \u5f00\u59cb\u548c\u7ed3\u675f\u90fd\u4f7f\u7528 INTERVAL\nCREATE EVENT event_scheduled\nON SCHEDULE EVERY 1 WEEK\nSTARTS NOW() + INTERVAL 1 DAY      -- 1\u5929\u540e\u5f00\u59cb\nENDS NOW() + INTERVAL 6 MONTH      -- 6\u4e2a\u6708\u540e\u7ed3\u675f\nDO BACKUP database;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"3-\u4e8b\u4ef6\u72b6\u6001",children:"3. \u4e8b\u4ef6\u72b6\u6001"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"ENABLE          -- \u542f\u7528\u4e8b\u4ef6\uff08\u9ed8\u8ba4\uff09\nDISABLE         -- \u7981\u7528\u4e8b\u4ef6\nDISABLE ON SLAVE -- \u4ec5\u5728\u4ece\u670d\u52a1\u5668\u4e0a\u7981\u7528\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u793a\u4f8b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE EVENT event_name\nON SCHEDULE EVERY 1 DAY\nDO ...\nENABLE;\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e5f\u53ef\u4ee5\u521b\u5efa\u540e\u4fee\u6539\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"ALTER EVENT event_name DISABLE;\nALTER EVENT event_name ENABLE;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"4-\u4e8b\u4ef6\u4f53do",children:"4. \u4e8b\u4ef6\u4f53\uff08DO\uff09"}),"\n",(0,s.jsx)(e.p,{children:"DO \u540e\u9762\u662f\u771f\u6b63\u8981\u6267\u884c\u7684 SQL\n\u53ef\u4ee5\u662f\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"INSERT"}),"\n",(0,s.jsx)(e.li,{children:"UPDATE"}),"\n",(0,s.jsx)(e.li,{children:"DELETE"}),"\n",(0,s.jsx)(e.li,{children:"CALL \u5b58\u50a8\u8fc7\u7a0b"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u793a\u4f8b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u7b80\u5355SQL\u8bed\u53e5\nDO DELETE FROM logs WHERE created_at < NOW() - INTERVAL 30 DAY;\n\n-- \u8c03\u7528\u5b58\u50a8\u8fc7\u7a0b\nDO CALL generate_report();\n\n-- \u4f7f\u7528 BEGIN...END \u5757\uff08\u591a\u6761\u8bed\u53e5\uff09\nDO BEGIN\n  UPDATE stats SET daily_count = 0;\n  INSERT INTO audit_log (action) VALUES ('Reset daily counters');\n  CALL cleanup_temp_data();\nEND\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u4e09\u5b9e\u9645\u5e94\u7528\u793a\u4f8b",children:"\u4e09\u3001\u5b9e\u9645\u5e94\u7528\u793a\u4f8b"}),"\n",(0,s.jsx)(e.h3,{id:"\u793a\u4f8b1\u6570\u636e\u6e05\u7406\u4efb\u52a1",children:"\u793a\u4f8b1\uff1a\u6570\u636e\u6e05\u7406\u4efb\u52a1"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u6bcf30\u5206\u949f\u6e05\u7406\u4e00\u6b21\u4e34\u65f6\u6570\u636e\nCREATE EVENT cleanup_temp\nON SCHEDULE EVERY 30 MINUTE\nDO\n  DELETE FROM temp_sessions \n  WHERE created_at < NOW() - INTERVAL 1 HOUR;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u793a\u4f8b2\u5b9a\u671f\u6570\u636e\u7edf\u8ba1",children:"\u793a\u4f8b2\uff1a\u5b9a\u671f\u6570\u636e\u7edf\u8ba1"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u6bcf\u5c0f\u65f6\u7edf\u8ba1\u4e00\u6b21\uff0c\u4ece10\u5206\u949f\u540e\u5f00\u59cb\nCREATE EVENT update_stats\nON SCHEDULE EVERY 1 HOUR\nSTARTS NOW() + INTERVAL 10 MINUTE\nDO\n  INSERT INTO hourly_stats (hour, total_users)\n  VALUES (NOW(), (SELECT COUNT(*) FROM users));\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u793a\u4f8b3\u7cfb\u7edf\u76d1\u63a7",children:"\u793a\u4f8b3\uff1a\u7cfb\u7edf\u76d1\u63a7"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u6bcf5\u79d2\u68c0\u67e5\u4e00\u6b21\u7cfb\u7edf\u72b6\u6001\nCREATE EVENT monitor_system\nON SCHEDULE EVERY 5 SECOND\nDO\n  INSERT INTO system_monitor (check_time, cpu_usage)\n  VALUES (NOW(), get_cpu_usage());\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u793a\u4f8b4\u6bcf\u5929\u51cc\u6668\u6267\u884ccurdate",children:"\u793a\u4f8b4\uff1a\u6bcf\u5929\u51cc\u6668\u6267\u884c(CURDATE())"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE EVENT midnight_job\nON SCHEDULE EVERY 1 DAY\nSTARTS CURDATE() + INTERVAL 1 DAY  -- \u660e\u5929\u51cc\u6668\u5f00\u59cb\nDO\n  UPDATE counters SET daily = 0;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u793a\u4f8b5\u6bcf\u67081\u53f7\u6267\u884c",children:"\u793a\u4f8b5\uff1a\u6bcf\u67081\u53f7\u6267\u884c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE EVENT first_day_month\nON SCHEDULE EVERY 1 MONTH\nSTARTS CURDATE() - INTERVAL DAY(CURDATE()) - 1 DAY + INTERVAL 1 MONTH\nDO\n  CALL generate_monthly_report();\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u793a\u4f8b6\u4f7f\u7528\u53d8\u91cf\u8bbe\u7f6e\u95f4\u9694",children:"\u793a\u4f8b6\uff1a\u4f7f\u7528\u53d8\u91cf\u8bbe\u7f6e\u95f4\u9694"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"SET @interval_minutes = 5;\n\nCREATE EVENT dynamic_interval\nON SCHEDULE EVERY @interval_minutes MINUTE\nDO SELECT 'This runs every 5 minutes';\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u793a\u4f8b7\u9a8c\u8bc1\u65f6\u95f4\u95f4\u9694",children:"\u793a\u4f8b7:\u9a8c\u8bc1\u65f6\u95f4\u95f4\u9694"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u67e5\u770b1\u5c0f\u65f630\u5206\u949f\u540e\u662f\u4ec0\u4e48\u65f6\u95f4\nSELECT NOW(), NOW() + INTERVAL 1 HOUR + INTERVAL 30 MINUTE;\n\n-- \u67e5\u770b3\u5929\u524d\u7684\u65f6\u95f4\nSELECT NOW(), NOW() - INTERVAL 3 DAY;\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u56db\u5e38\u89c1\u4e8b\u4ef6\u793a\u4f8b",children:"\u56db\u3001\u5e38\u89c1\u4e8b\u4ef6\u793a\u4f8b"}),"\n",(0,s.jsx)(e.h3,{id:"1-\u4e00\u6b21\u6027\u4e8b\u4ef6",children:"1. \u4e00\u6b21\u6027\u4e8b\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE EVENT cleanup_logs\nON SCHEDULE AT CURRENT_TIMESTAMP + INTERVAL 1 HOUR\nDO\n  DELETE FROM logs WHERE created_at < NOW() - INTERVAL 30 DAY;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"2-\u5468\u671f\u6027\u4e8b\u4ef6",children:"2. \u5468\u671f\u6027\u4e8b\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE EVENT daily_report\nON SCHEDULE EVERY 1 DAY\nSTARTS '2024-01-01 02:00:00'\nDO\n  CALL generate_daily_report();\n"})}),"\n",(0,s.jsx)(e.h3,{id:"3-\u590d\u6742\u4e8b\u4ef6",children:"3. \u590d\u6742\u4e8b\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE EVENT optimize_tables\nON SCHEDULE EVERY 1 WEEK\nSTARTS '2024-01-07 03:00:00'\nCOMMENT '\u6bcf\u5468\u4f18\u5316\u8868'\nDO\nBEGIN\n  OPTIMIZE TABLE users, orders, products;\n  INSERT INTO event_log (message) VALUES ('\u8868\u4f18\u5316\u5b8c\u6210');\nEND\n"})}),"\n",(0,s.jsx)(e.h3,{id:"4\u5176\u4ed6\u4e8b\u4ef6",children:"4.\u5176\u4ed6\u4e8b\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u521b\u5efa\u4e8b\u4ef6\u65e5\u5fd7\u8868\nCREATE TABLE event_log (\n    info VARCHAR(50),\n    created_at DATETIME\n);\n-- \u6bcf\u5206\u949f\u5f80\u65e5\u5fd7\u8868\u63d2\u4e00\u6761\u8bb0\u5f55\nCREATE EVENT log_event\nON SCHEDULE EVERY 1 MINUTE\nDO\nINSERT INTO event_log VALUES ('event run', NOW());\n\n-- \u6bcf\u5929\u51cc\u6668\u6e05\u7406\u8fc7\u671f\u6570\u636e\uff08\u7ecf\u5178\uff09\nCREATE EVENT clear_old_logs\nON SCHEDULE EVERY 1 DAY\nSTARTS '2026-02-01 00:00:00'\nDO\nDELETE FROM logs\nWHERE created_at < NOW() - INTERVAL 30 DAY;\n\n-- \u5b9a\u65f6\u7edf\u8ba1\u6570\u636e\nCREATE EVENT daily_stat\nON SCHEDULE EVERY 1 DAY\nSTARTS '2026-02-01 01:00:00'\nDO\nINSERT INTO stat_table(day, total)\nSELECT CURDATE(), COUNT(*) FROM orders;\n\n-- \u4e8b\u4ef6\u4e2d\u8c03\u7528\u5b58\u50a8\u8fc7\u7a0b\nCREATE EVENT month_settle\nON SCHEDULE EVERY 1 MONTH\nDO\nCALL settle_accounts();\n"})}),"\n",(0,s.jsx)(e.h3,{id:"5\u5b8c\u6574\u793a\u4f8b",children:"5.\u5b8c\u6574\u793a\u4f8b"}),"\n",(0,s.jsx)(e.h4,{id:"\u793a\u4f8b1\u6bcf\u65e5\u6e05\u7406\u4efb\u52a1",children:"\u793a\u4f8b1\uff1a\u6bcf\u65e5\u6e05\u7406\u4efb\u52a1"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE EVENT daily_cleanup\nON SCHEDULE EVERY 1 DAY\nSTARTS '2024-01-01 03:00:00'\nON COMPLETION PRESERVE\nENABLE\nCOMMENT '\u6bcf\u65e5\u6e05\u7406\u8fc7\u671f\u6570\u636e'\nDO\n  BEGIN\n    DELETE FROM sessions WHERE expires_at < NOW();\n    DELETE FROM temp_files WHERE created_at < NOW() - INTERVAL 7 DAY;\n    OPTIMIZE TABLE logs;\n  END;\n"})}),"\n",(0,s.jsx)(e.h4,{id:"\u793a\u4f8b2\u6bcf\u5c0f\u65f6\u7edf\u8ba1\u6570\u636e",children:"\u793a\u4f8b2\uff1a\u6bcf\u5c0f\u65f6\u7edf\u8ba1\u6570\u636e"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE EVENT hourly_stats\nON SCHEDULE EVERY 1 HOUR\nDO\n  INSERT INTO system_stats \n  SELECT NOW(), COUNT(*) as active_users, \n         (SELECT COUNT(*) FROM orders WHERE status = 'completed') as completed_orders\n  FROM users WHERE last_active > NOW() - INTERVAL 30 MINUTE;\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u8fd9\u867d\u7136\u662f\u591a\u884c\uff0c\u4f46\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u5355\u6761 INSERT ... SELECT \u8bed\u53e5"}),"\n",(0,s.jsx)(e.li,{children:"\u5b50\u67e5\u8be2 (SELECT COUNT(*) FROM orders ...) \u662f SELECT \u8bed\u53e5\u7684\u4e00\u90e8\u5206"}),"\n",(0,s.jsx)(e.li,{children:"\u4e0d\u9700\u8981 BEGIN ... END"}),"\n"]}),"\n",(0,s.jsx)(e.h4,{id:"\u793a\u4f8b3\u6708\u5ea6\u5f52\u6863",children:"\u793a\u4f8b3\uff1a\u6708\u5ea6\u5f52\u6863"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE EVENT monthly_archive\nON SCHEDULE EVERY 1 MONTH\nSTARTS '2024-02-01 00:00:00'\nCOMMENT '\u6bcf\u6708\u5f52\u6863\u4e0a\u6708\u6570\u636e'\nDO\n  BEGIN\n    -- \u5f52\u6863\u4e0a\u6708\u6570\u636e\n    INSERT INTO orders_archive \n    SELECT * FROM orders \n    WHERE order_date < DATE_FORMAT(NOW() - INTERVAL 1 MONTH, '%Y-%m-01');\n    \n    -- \u5220\u9664\u5df2\u5f52\u6863\u6570\u636e\n    DELETE FROM orders \n    WHERE order_date < DATE_FORMAT(NOW() - INTERVAL 1 MONTH, '%Y-%m-01');\n  END;\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u4e94\u7ba1\u7406\u4e8b\u4ef6",children:"\u4e94\u3001\u7ba1\u7406\u4e8b\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u67e5\u770b\u6240\u6709\u4e8b\u4ef6\nSHOW EVENTS;\n\n-- \u67e5\u770b\u4e8b\u4ef6\u5b9a\u4e49\nSHOW CREATE EVENT event_name;\n\n-- \u4fee\u6539\u4e8b\u4ef6\nALTER EVENT event_name\n  ON SCHEDULE EVERY 1 HOUR\n  DO ...;\n\n-- \u4e34\u65f6\u7981\u7528\u4e8b\u4ef6\nALTER EVENT event_name DISABLE;\n\n-- \u542f\u7528\u4e8b\u4ef6\nALTER EVENT event_name ENABLE;\n\n-- \u5220\u9664\u4e8b\u4ef6\nDROP EVENT event_name;\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u516d\u603b\u7ed3",children:"\u516d\u3001\u603b\u7ed3"}),"\n",(0,s.jsx)(e.h3,{id:"1interval\u7684\u5e38\u89c1\u7528\u6cd5",children:"1.INTERVAL\u7684\u5e38\u89c1\u7528\u6cd5"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"EVERY n unit"})," - \u5468\u671f\u6027\u6267\u884c"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"AT NOW() + INTERVAL n unit"})," - \u5ef6\u8fdf\u6267\u884c"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"STARTS/ENDS + INTERVAL"})," - \u63a7\u5236\u65f6\u95f4\u8303\u56f4"]}),"\n",(0,s.jsxs)(e.li,{children:["\u53ef\u4ee5\u7ec4\u5408\uff1a",(0,s.jsx)(e.code,{children:"INTERVAL 1 DAY + INTERVAL 2 HOUR"})]}),"\n",(0,s.jsx)(e.li,{children:"\u652f\u6301\u6240\u6709\u5e38\u7528\u65f6\u95f4\u5355\u4f4d\uff1aSECOND\u5230YEAR"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u8bb0\u4f4f\uff1a\u6570\u5b57\u548c\u5355\u4f4d\u4e4b\u95f4\u5fc5\u987b\u6709\u7a7a\u683c\uff0c",(0,s.jsx)(e.code,{children:"INTERVAL 5 MINUTE"}),"\uff08\u6b63\u786e\uff09 vs ",(0,s.jsx)(e.code,{children:"INTERVAL 5MINUTE"}),"\uff08\u9519\u8bef\uff09\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"2do-\u5b50\u53e5",children:"2.DO \u5b50\u53e5"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"DO"})," \u540e\u9762\u662f\u771f\u6b63\u8981\u6267\u884c\u7684 SQL"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u53ef\u4ee5\u662f\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"INSERT"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"UPDATE"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"DELETE"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"CALL \u5b58\u50a8\u8fc7\u7a0b"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"3enable--disable\u542f\u7528\u4e0e\u505c\u7528",children:"3.ENABLE / DISABLE\uff08\u542f\u7528\u4e0e\u505c\u7528\uff09"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE EVENT event_name\nON SCHEDULE EVERY 1 DAY\nDO ...\nENABLE;\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e5f\u53ef\u4ee5\u521b\u5efa\u540e\u4fee\u6539\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"ALTER EVENT event_name DISABLE;\nALTER EVENT event_name ENABLE;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"4\u5b9e\u9645\u5f00\u53d1\u4e2d",children:"4.\u5b9e\u9645\u5f00\u53d1\u4e2d\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u590d\u6742\u903b\u8f91\u5199\u5728\u5b58\u50a8\u8fc7\u7a0b"}),"\n",(0,s.jsx)(e.li,{children:"\u4e8b\u4ef6\u53ea\u8d1f\u8d23\u201c\u5b9a\u65f6\u89e6\u53d1\u201d"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"5\u4e8b\u4ef6\u80fd\u505a\u4ec0\u4e48",children:"5.\u4e8b\u4ef6\u80fd\u505a\u4ec0\u4e48\uff1f"}),"\n",(0,s.jsx)(e.p,{children:"\u4e8b\u4ef6\u53ef\u4ee5\u6267\u884c\u4efb\u4f55 SQL \u8bed\u53e5\uff0c\u4f8b\u5982\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5220\u9664\u8fc7\u671f\u6570\u636e"}),"\n",(0,s.jsx)(e.li,{children:"\u5b9a\u671f\u66f4\u65b0\u72b6\u6001\u5b57\u6bb5"}),"\n",(0,s.jsx)(e.li,{children:"\u751f\u6210\u6bcf\u65e5/\u6708\u5ea6\u62a5\u544a"}),"\n",(0,s.jsx)(e.li,{children:"\u5f52\u6863\u65e7\u8bb0\u5f55"}),"\n",(0,s.jsx)(e.li,{children:"\u91cd\u7f6e\u8ba1\u6570\u5668"}),"\n",(0,s.jsx)(e.li,{children:"\u540c\u6b65\u6570\u636e"}),"\n"]})]})}function N(n={}){const{wrapper:e}={...(0,d.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(T,{...n})}):T(n)}},8453(n,e,E){E.d(e,{R:()=>i,x:()=>c});var l=E(6540);const s={},d=l.createContext(s);function i(n){const e=l.useContext(d);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:i(n.components),l.createElement(d.Provider,{value:e},n.children)}}}]);