---
# 这部分是关键！侧边栏显示名由这里决定
title: 任务四 存储函数  # 文档标题，若无 sidebar_label 则作为侧边栏名
sidebar_label: 任务四 存储函数 # 显式指定侧边栏显示名（优先级最高）
sidebar_position: 4  # 侧边栏中排在第1位
---
## 一、存储函数是什么

**一句话定义：**

> **存储函数是存储在 MySQL 服务器中的“可返回单个值的函数”，可以像普通函数一样在 SQL 语句中被调用。**

特点：

* **必须有返回值**
* **只能返回一个值**
* **可在 `SELECT / WHERE / ORDER BY` 等表达式中使用**

与存储过程对比：

| 维度           | 存储函数           | 存储过程         |
| ------------ | -------------- | ------------ |
| 核心目的         | 返回一个值          | 完成一件事        |
| 是否必须返回值      | 必须             | 不必须          |
| 返回方式         | `RETURN`       | `OUT` 参数（可选） |
| 调用方式         | `SELECT 函数名()` | `CALL 过程名()` |
| 是否可用于 SELECT | 可以             | 不可以          |

- **函数算值，过程做事**
- **要结果用函数，要流程用过程**
- **存储过程关注“过程和动作”，而存储函数关注“计算和结果”。**

| 对比项          | 存储函数            | 存储过程          |
| ------------ | --------------- | ------------- |
| 是否有返回值       | ✅ 必须有           | ❌ 不必须         |
| 返回值数量        | 一个              | 0 / 多个        |
| 调用方式         | `SELECT func()` | `CALL proc()` |
| 能否用于 SQL 表达式 | ✅ 可以            | ❌ 不可以         |
| 适合场景         | 计算、转换、判断        | 业务流程          |

## 二、创建存储函数的基本语法

```sql
-- 定义存储函数
DELIMITER $$

CREATE FUNCTION 函数名(参数名 参数类型, ...)
RETURNS 返回值类型
BEGIN
    -- 函数体（必须有 RETURN）
    RETURN 返回值;
END $$

DELIMITER ;

-- 调用存储函数
SELECT function_name(); -- 无参调用
SELECT function_name(argument1, argument2, ...); -- 带参调用
```

语法要点

| 项目                | 说明             |
| ----------------- | -------------- |
| `CREATE FUNCTION` | 定义存储函数         |
| 参数                | 可以有 0 个或多个     |
| `RETURNS`         | **必须**，定义返回类型 |
| `RETURN`          | **必须**，只能返回一个值  |
| `BEGIN...END`     | 多条语句时使用        |

---

## 三、示例

### 示例 1：返回一个固定值

```sql
DELIMITER $$

CREATE FUNCTION hello()
RETURNS VARCHAR(20)
BEGIN
    RETURN 'Hello MySQL';
END $$

DELIMITER ;
```

**调用方式：**

```sql
SELECT hello();
```

📌 输出：

```
Hello MySQL
```
### 示例2：计算两个数的和

```sql
DELIMITER $$

CREATE FUNCTION add_numbers(a INT, b INT)
RETURNS INT
BEGIN
    RETURN a + b;
END $$

DELIMITER ;
```

**使用：**

```sql
SELECT add_numbers(3, 5);
```

📌 输出：

```
8
```

---

### 示例 3：根据成绩返回等级

```sql
DELIMITER $$

CREATE FUNCTION score_level(score INT)
RETURNS VARCHAR(10)
BEGIN
    IF score >= 90 THEN
        RETURN '优秀';
    ELSEIF score >= 80 THEN
        RETURN '良好';
    ELSEIF score >= 60 THEN
        RETURN '及格';
    ELSE
        RETURN '不及格';
    END IF;
END $$

DELIMITER ;
```

**使用：**

```sql
SELECT score_level(85);
```

### 示例4：在 `SELECT` 中使用

```sql
SELECT name, score, score_level(score) AS level
FROM students;
```

👉 这就是 **存储函数最大的价值**：
**像系统函数一样参与查询**


### 示例 5：在 `WHERE` 中使用

```sql
SELECT *
FROM students
WHERE score_level(score) = '优秀';
```

---


## 四、注意事项

### ⚠️ 1. 必须有 `RETURNS` + `RETURN`

少一个都会报错

### ⚠️ 2. 函数中一般**不能修改表数据**

```sql
-- 不推荐在函数中使用：
INSERT / UPDATE / DELETE
```

📌 原因：函数可能被频繁调用，破坏数据一致性

### ⚠️ 3. 创建函数需要权限

可能遇到这个错误：

```
This function has none of DETERMINISTIC...
```

解决（开发环境）：

```sql
SET GLOBAL log_bin_trust_function_creators = 1;
```

### ⚠️ 4. 函数返回值类型要准确

* 返回字符串 → `VARCHAR`
* 返回小数 → `DECIMAL`
* 返回日期 → `DATE`

---


## 五、对比：存储函数 / 存储过程 / 触发器 / 事件 

### 1.核心对比

| 对比维度        | 存储函数 (Function)      | 存储过程 (Procedure) | 触发器 (Trigger)              | 事件 (Event)    |
| ----------- | -------------------- | ---------------- | -------------------------- | ------------- |
| 本质          | **返回值的函数**           | **可执行的过程**       | **被动自动执行**                 | **定时自动执行**    |
| 是否有返回值      | ✅ 必须有（1 个）           | ❌ 不必须            | ❌ 没有                       | ❌ 没有          |
| 返回值数量       | 1 个                  | 0 / 多个（OUT）      | 无                          | 无             |
| 调用方式        | `SELECT f()`         | `CALL p()`       | **自动触发**                   | **到点执行**      |
| 能否用于 SELECT | ✅ 可以                 | ❌ 不可以            | ❌ 不可以                      | ❌ 不可以         |
| 是否可接收参数     | ✅                    | ✅                | ❌                          | ❌             |
| 是否依赖表操作     | ❌ 可不依赖               | ❌ 可不依赖           | ✅ 必须依赖                     | ❌ 不依赖         |
| 执行时机        | 手动调用                 | 手动调用             | **INSERT/UPDATE/DELETE 时** | **指定时间**      |
| 是否可修改数据     | ⚠️ 不推荐               | ✅ 可以             | ✅ 可以                       | ✅ 可以          |
| 常见关键词       | `RETURNS` / `RETURN` | `IN / OUT`       | `BEFORE / AFTER`           | `ON SCHEDULE` |

### 2.一句话定位

| 类型   | 一句话定位        |
| ---- | ------------ |
| 存储函数 | **算一个值**     |
| 存储过程 | **做一件事**     |
| 触发器  | **有人动表，我就动** |
| 事件   | **到点我自动动**   |

📌 **记忆神句（强烈推荐）**：

> **函数算值，过程做事，触发器盯表，事件看表**

### 3.是否「自动执行」

| 类型  | 是否自动执行 | 触发条件  |
| --- | ------ | ----- |
| 函数  | ❌      | 手动调用  |
| 过程  | ❌      | 手动调用  |
| 触发器 | ✅      | 表数据变化 |
| 事件  | ✅      | 时间到   |

📌 **自动执行的只有两个**：
👉 **触发器 + 事件**

---

### 4. 是否「参与查询」

| 类型  | 能否写在 SELECT 里 |
| --- | ------------- |
| 函数  | ✅             |
| 过程  | ❌             |
| 触发器 | ❌             |
| 事件  | ❌             |

📌 **只有函数能进 SELECT**

### 5.极简记忆

> * **函数**：有返回值，可用于 SELECT
> * **过程**：无固定返回值，用 CALL 调
> * **触发器**：表变自动执行
> * **事件**：定时自动执行

---

## 六、常见错误总结

### ❌ 错误说法 1：

> 存储过程可以像函数一样在 SELECT 中使用
> ✅ **错**

---

### ❌ 错误说法 2：

> 触发器需要手动调用
> ✅ **错**

---

### ❌ 错误说法 3：

> 事件依赖 INSERT / UPDATE / DELETE
> ✅ **错**

---

### ❌ 错误说法 4：

> 函数可以返回多个值
> ✅ **错**

---

## 七、怎么选？

👉 问自己一句话：

1️⃣ **我要不要一个值？**
→ 要 → **函数**

2️⃣ **我要不要人来调用？**
→ 要 → **过程 / 函数**

3️⃣ **是不是表一变就要自动做？**
→ 是 → **触发器**

4️⃣ **是不是到某个时间自动做？**
→ 是 → **事件**

