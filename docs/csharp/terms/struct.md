---
noteId: "7fa7f7e04ca311f0a4447ff1d733314e"
tags: []

---

### **C# 结构体（Struct）详解**

结构体（**struct**）是 C# 中的一种**值类型**，用于封装轻量级数据。它与类（**class**）相似，但具有关键差异，适用于特定场景。以下是结构体的全面解析：

---

## **1. 结构体的定义**
```csharp
public struct Point
{
    // 字段
    public int X;
    public int Y;

    // 构造函数（必须初始化所有字段）
    public Point(int x, int y)
    {
        X = x;
        Y = y;
    }

    // 方法
    public void Print()
    {
        Console.WriteLine($"({X}, {Y})");
    }
}
```

---

## **2. 结构体的核心特性**
### **(1) 值类型（Value Type）**
- **存储位置**：通常分配在**栈（Stack）**上（除非嵌入引用类型中）。
- **赋值行为**：赋值时**复制整个值**（深拷贝），而非引用。
  ```csharp
  Point p1 = new Point(1, 2);
  Point p2 = p1; // p2 是 p1 的完整副本
  p2.X = 3;      // 修改 p2 不会影响 p1
  ```

### **(2) 默认构造函数**
- 结构体**隐式包含无参构造函数**，且**不能自定义无参构造函数**。
- 所有字段必须在构造函数中初始化：
  ```csharp
  // 错误：结构体不能显式定义无参构造函数
  // public Point() { X = 0; Y = 0; }
  ```

### **(3) 继承限制**
- 结构体**不能继承其他类或结构体**（隐式继承自 `System.ValueType`）。
- **不能作为基类**被继承。

### **(4) 不可为 null（除非使用 `Nullable<T>`）**
- 结构体默认不可为 `null`，但可通过 `Nullable<T>`（即 `T?`）实现：
  ```csharp
  Point? p = null; // 等价于 Nullable<Point>
  ```

---

## **3. 结构体 vs 类（Class）**
| **特性**               | **结构体（Struct）**                | **类（Class）**                  |
|------------------------|------------------------------------|----------------------------------|
| **类型**               | 值类型（栈）                       | 引用类型（堆）                   |
| **赋值行为**           | 复制整个值（深拷贝）               | 复制引用（浅拷贝）               |
| **继承**               | 不支持                             | 支持单继承                       |
| **默认构造函数**       | 自动生成，不可自定义无参构造函数   | 可自定义                         |
| **可为 null**          | 需用 `Nullable<T>`                 | 直接支持                         |
| **适用场景**           | 小型、不可变数据（如坐标、颜色）   | 复杂对象、需继承或多态的场景     |

---

## **4. 结构体的适用场景**
### **(1) 轻量级数据**
- 如坐标点（`Point`）、颜色（`Color`）、日期时间（`DateTime`）。
- 数据大小通常小于 16 字节（超过时建议用类）。

### **(2) 不可变性设计**
- 通过 `readonly struct` 确保数据不可变：
  ```csharp
  public readonly struct ImmutablePoint
  {
      public readonly int X;
      public readonly int Y;
      // 构造函数必须初始化所有字段
  }
  ```

### **(3) 高性能场景**
- 避免堆内存分配（减少 GC 压力），适合高频创建的对象。

---

## **5. 结构体的限制**
1. **不能包含无参构造函数**（编译器自动生成）。
2. **字段必须显式初始化**（构造函数中必须赋值所有字段）。
3. **不适合复杂逻辑**：因值类型特性，频繁拷贝可能影响性能。

---

## **6. 实际示例**
### **(1) 坐标点（Point）**
```csharp
public struct Point
{
    public int X;
    public int Y;
    public Point(int x, int y) => (X, Y) = (x, y);
}

// 使用
Point p = new Point(10, 20);
Console.WriteLine(p.X); // 输出 10
```

### **(2) RGB 颜色（Color）**
```csharp
public struct RgbColor
{
    public byte Red;
    public byte Green;
    public byte Blue;
}
```

### **(3) 自定义值类型**
```csharp
public struct Temperature
{
    public double Celsius;
    public double Fahrenheit => Celsius * 9 / 5 + 32;
}
```

---

## **7. 何时用结构体？何时用类？**
| **场景**                  | **选择**      | **原因**                          |
|---------------------------|--------------|-----------------------------------|
| 小型、不可变数据（<16B）  | 结构体       | 避免堆分配，提升性能              |
| 需要继承或多态            | 类           | 结构体不支持继承                  |
| 频繁修改数据              | 类           | 结构体拷贝开销大                  |
| 高频创建临时对象          | 结构体       | 减少 GC 压力                      |

---

## **8. 总结**
- **结构体是值类型**，适合轻量级、不可变数据。
- **与类的关键区别**：存储位置、赋值行为、继承支持。
- **优先使用类**，仅在性能敏感或数据简单时用结构体。

理解结构体的特性，能帮助你在内存管理和性能优化中做出更合理的设计选择！

